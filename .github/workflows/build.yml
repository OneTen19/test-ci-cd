# This workflow will build a Swift project
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-swift

name: Build Test

# main Î∏åÎûúÏπòÏóê push ÎêòÎ©¥ Ïã§Ìñâ
on:
  push:
    branches: [ "main" ]
  # pull_request:
  #   branches: [ "main" ]

# ÏµúÏã† pushÏóê Í¥ÄÌïú CI ÏûëÏóÖÎßå ÏàòÌñâ
concurrency:
  group: build-${{ github.ref }}
  cancel-in-progress: true

jobs:
  build:
    name: Build iOS Project
    runs-on: macos-15

    env:
      SECRET_XCCONFIG_PATH: Config.xcconfig

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    # üîß Í≤ΩÎ°ú ÏÉùÏÑ±
    - name: Create directory for Config.xcconfig
      run: mkdir -p $(dirname "${{ env.SECRET_XCCONFIG_PATH }}")

    # üîê SecretÏóêÏÑú config ÌååÏùº ÏÉùÏÑ±
    - name: Generate Config.xcconfig from secret
      run: |
        echo "${{ secrets.CONFIG_XCCONFIG }}" | base64 --decode > "${{ env.SECRET_XCCONFIG_PATH }}"
      
    - name: Build project (Simulator build to avoid codesign) üõ†Ô∏è
      run: |
        xcodebuild clean build \
        -project Test-Study.xcodeproj \
        -scheme Test-Study \
        -destination 'platform=iOS Simulator,name=iPhone SE (3rd generation),OS=18.5' \
        CODE_SIGNING_ALLOWED=NO
